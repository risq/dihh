var Api=function(){function e(){$.ajaxSetup({cache:!1})}function t(e,t,i){var o=e.page||0;NProgress.start(),$.getJSON("/digs/page/"+o).done(function(e){t(n(e))}).fail(i).always(function(){NProgress.done()})}function n(e){return $.map(e,function(e){return{id:e._id,title:e.title,artist:e.artists.join(", "),artists:e.artists,year:e.year,cover:e.cover.indexOf("http://")>-1?e.cover:"/uploads/"+e.cover,links:e.links,hasSleeve:!1}}).reverse()}return{init:e,getDigs:t}}(),App=function(){function e(){Routing.init(),Ui.init(),Player.init(),t(),o(Routing.getCurrentPage())}function t(){cratedigger.init({postprocessing:!1,sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},infoPanelOpened:Ui.onInfoPanelOpened,infoPanelClosed:Ui.onInfoPanelClosed})}function n(){o(Routing.getCurrentPage()-1,!0)}function i(){o(Routing.getCurrentPage()+1,!0)}function o(e,t){Api.getDigs({page:e},function(n){cratedigger.loadRecords(n,!1),Routing.changePage(e,t)},function(e){console.log("Error",e)})}return{init:e,loadPage:o,prevPage:n,nextPage:i}}(),Comments=function(){function e(e,o){i?n(e,"http://localhost:8080/"+e,o):t(e,"http://localhost:8080/"+e,o)}function t(e,t,n){window.disqus_shortname=o,window.disqus_identifier=e,window.disqus_url=t,window.disqus_title=n;var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="//"+o+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(r),console.log("loaded !"),i=!0}function n(e,t,n){DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.identifier=e,this.page.url=t,this.page.title=n}})}var i=!1,o="dihh";return{loadCommentsForTrack:e}}(),Player=function(){function e(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),window.onYouTubeIframeAPIReady=t}function t(){r=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:1,rel:0,showinfo:0,modestbranding:1},events:{onReady:i,onStateChange:o}})}function n(e){a&&(console.log(e.played),r.loadVideoById(e.links.youtube),r.playVideo(),e.played=!0)}function i(){a=!0}function o(){}var r,a=!1;return{init:e,playTrack:n}}(),Routing=function(){function e(){o=$("#cratedigger"),r=parseInt(o.attr("data-cratedigger-page")),window.history.replaceState({page:r},"Page "+r,0===r?"/":"/page/"+r),window.onpopstate=i}function t(){return r}function n(e,t){if(t){var n=0===e?"/":"/page/"+e;window.history.pushState({page:e},"Page "+e,n)}r=e,o.attr("data-cratedigger-page",e)}function i(e){e.state&&e.state.page>=0&&(r=e.state.page,App.loadPage(r))}var o,r=0;return{init:e,changePage:n,getCurrentPage:t}}(),Ui=function(){function e(){r=$("#bottom-bar"),a=r.find(".bottom-bar-prev-button"),c=r.find(".bottom-bar-mid-button"),d=r.find(".bottom-bar-next-button"),g=$(".button-prev-page"),s=$(".button-next-page"),u=$("#cratedigger-record-listen"),l=$(".track .track-artist"),p=$(".track .track-title"),a.on("click",cratedigger.selectPrevRecord),c.on("click",cratedigger.flipSelectedRecord),d.on("click",cratedigger.selectNextRecord),u.on("click",function(){return n(),!1}),g.on("click",function(){return App.prevPage(),!1}),s.on("click",function(){return App.nextPage(),!1})}function t(e,t){if(console.log(e),f!==e.id){var n=e.artists.join(","),i=n+" - "+e.title;f=e.id,l.text(n),p.text(e.title),Comments.loadCommentsForTrack(e.id,i),t&&Player.playTrack(e)}}function n(){t(cratedigger.getSelectedRecord().data,!0)}function i(){r.addClass("closed")}function o(){r.removeClass("closed")}var r,a,c,d,g,s,u,l,p,f;return{init:e,onInfoPanelOpened:i,onInfoPanelClosed:o}}();
//# sourceMappingURL=app.min.js.map