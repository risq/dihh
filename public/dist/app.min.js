var Api=function(){function e(){$.ajaxSetup({cache:!1})}function t(e,t,r){var i=e.page||0;NProgress.start(),$.getJSON("/digs/page/"+i).done(function(e){t(n(e))}).fail(r).always(function(){NProgress.done()})}function n(e){return $.each(e,function(e,t){t.artist=t.artists.join(", "),t.cover=t.cover.indexOf("http://")>-1?t.cover:"/uploads/"+t.cover,t.links=t.links||{},t.links.youtube="//www.youtube.com/watch?v="+t.youtubeId}).reverse()}return{init:e,getDigs:t}}(),App=function(){function e(){Intro.init(),Ui.init(),Routing.init(),Player.init(),t(),i(Routing.getCurrentPageId(),Routing.getCurrentDigId(),!1,Intro.startIntro)}function t(){cratedigger.init({debug:!1,postprocessing:!1,sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},onInfoPanelOpened:Ui.onInfoPanelOpened,onInfoPanelClosed:Ui.onInfoPanelClosed})}function n(){i(Routing.getCurrentPageId()-1,null,!0)}function r(){i(Routing.getCurrentPageId()+1,null,!0)}function i(e,t,n,r){Api.getDigs({page:e},function(i){r&&r(),cratedigger.loadRecords(i,!1,function(){Routing.changePage(e,t,n)})},function(e){console.log("Error",e)})}function o(e){for(var t,n=cratedigger.getRecordsDataList(),r=n.slice();t=r.pop();)if(t._id===e)return{dig:t,index:r.length};return null}function a(e){setTimeout(function(){cratedigger.selectRecord(e)},1500)}return{init:e,loadPage:i,prevPage:n,nextPage:r,getRecordById:o,selectRecord:a}}(),Comments=function(){function e(e,i){r?n(e,"http://localhost:8080/"+e,i):t(e,"http://localhost:8080/"+e,i)}function t(e,t,n){window.disqus_shortname=i,window.disqus_identifier=e,window.disqus_url=t,window.disqus_title=n;var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="//"+i+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(o),r=!0}function n(e,t,n){DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.identifier=e,this.page.url=t,this.page.title=n}})}var r=!1,i="dihh";return{loadCommentsForTrack:e}}(),Intro=function(){function e(){i=$(".intro")}function t(){a=!1,setTimeout(n,1e3),setTimeout(function(){r()},15e3)}function n(){o=new Vivus("intro-svg",{file:"/img/intro.svg",type:"delayed",duration:250,start:"autostart"},r)}function r(){a||(a=!0,setTimeout(function(){i.addClass("intro-hidden"),setTimeout(function(){i.remove()},1250)},2e3))}var i,o,a;return{init:e,startIntro:t}}(),Player=function(){function e(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),window.onYouTubeIframeAPIReady=t}function t(){c=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:1,rel:0,showinfo:0,modestbranding:1},events:{onReady:r,onStateChange:i}})}function n(e,t){g&&(c.cueVideoById(e.youtubeId),t&&c.playVideo(),u=e)}function r(e){g=!0}function i(e){}function o(){var e=cratedigger.getRecordsDataList(),t=e.indexOf(u);return 0>t?e[0]:t>=e.length-1?e[0]:e[t+1]}function a(){var e=cratedigger.getRecordsDataList(),t=e.indexOf(u);return 0>t?e[e.length-1]:0===t?e[e.length-1]:e[t-1]}var c,g=!1,u=null;return{init:e,loadTrack:n,getNextTrack:a,getPrevTrack:o}}(),Routing=function(){function e(){c=Ui.getCurrentPageId(),g=Ui.getCurrentDigId(),window.onpopstate=r}function t(e,t,n){var r=t?App.getRecordById(t):null,o=r?r.dig.slug:null;if(n){var a=i(e,o);window.history.pushState({page:e},"Page "+e,a)}r&&(Ui.updateTrackView(r.dig),App.selectRecord(r.index)),c=e,Ui.onPageChange(e)}function n(e){var t=i(c,e);window.history.replaceState({page:c},"Page "+c,t)}function r(e){e.state&&e.state.page>=1&&(c=e.state.page,App.loadPage(c))}function i(e,t){return(1===e?"/":"/page/"+e+"/")+(t?"digs/"+t:"")}function o(){return c}function a(){return g}var c=0,g=null;return{init:e,changePage:t,changeDig:n,getCurrentPageId:o,getCurrentDigId:a}}(),Ui=function(){function e(){s=$("#cratedigger"),l=$(".page-number"),f=$("#bottom-bar"),p=f.find(".bottom-bar-prev-button"),m=f.find(".bottom-bar-mid-button"),v=f.find(".bottom-bar-next-button"),h=$(".button-prev-page"),k=$(".button-next-page"),I=$("#cratedigger-record-listen"),P=$(".track .track-artist"),w=$(".track .track-title"),y=$(".track .track-year"),b=$(".track .track-label"),C=$(".track .track-description"),R=$(".track .track-links"),x=$(".button-prev-track"),T=$(".button-next-track"),p.on("click",cratedigger.selectPrevRecord),m.on("click",function(){cratedigger.getSelectedRecord()?cratedigger.flipSelectedRecord():cratedigger.selectNextRecord()}),v.on("click",cratedigger.selectNextRecord),I.on("click",function(){return n(),!1}),h.on("click",function(){return App.prevPage(),!1}),k.on("click",function(){return App.nextPage(),!1}),x.on("click",o),T.on("click",a),S=u()}function t(e,t){if(D!==e._id){var n=e.artists.join(","),r=n+" - "+e.title;D=e._id,P.text(n),w.text(e.title),y.text(e.year),b.text(e.label||""),C.text(e.description||""),R.empty();for(var i in e.links)e.links.hasOwnProperty(i)&&R.append('<a href="'+e.links[i]+'" class="button button-black button-small" target="_blank">'+i+"</a>");Comments.loadCommentsForTrack(e._id,r),e.slug&&Routing.changeDig(e.slug),Player.loadTrack(e,t)}}function n(e){t(cratedigger.getSelectedRecord().data,!0)}function r(){f.addClass("closed")}function i(){f.removeClass("closed")}function o(){t(Player.getPrevTrack(),!0)}function a(){t(Player.getNextTrack(),!0)}function c(e){s.attr("data-cratedigger-page",e),l.text(e),1===e?h.hide():e===S?k.hide():(h.show(),k.show())}function g(){return parseInt(s.attr("data-cratedigger-page"))}function u(){return parseInt(s.attr("data-cratedigger-pages-count"))}function d(){return s.attr("data-cratedigger-record")||null}var s,l,f,p,m,v,h,k,I,P,w,y,b,C,R,x,T,D,S;return{init:e,updateTrackView:t,onInfoPanelOpened:r,onInfoPanelClosed:i,onPageChange:c,getCurrentPageId:g,getPagesCount:u,getCurrentDigId:d}}();
//# sourceMappingURL=app.min.js.map