var Api=function(){function e(){$.ajaxSetup({cache:!1})}function t(e,t,r){var i=e.page||0;NProgress.start(),$.getJSON("/digs/page/"+i).done(function(e){t(n(e))}).fail(r).always(function(){NProgress.done()})}function n(e){return $.map(e,function(e){return{id:e._id,title:e.title,artist:e.artists.join(", "),artists:e.artists,year:e.year,cover:e.cover.indexOf("http://")>-1?e.cover:"/uploads/"+e.cover,links:e.links,hasSleeve:!1}}).reverse()}return{init:e,getDigs:t}}(),App=function(){function e(){Routing.init(),Ui.init(),Player.init(),t(),i(Routing.getCurrentPage())}function t(){cratedigger.init({postprocessing:!1,sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},infoPanelOpened:Ui.onInfoPanelOpened,infoPanelClosed:Ui.onInfoPanelClosed})}function n(){i(Routing.getCurrentPage()-1,!0)}function r(){i(Routing.getCurrentPage()+1,!0)}function i(e,t){Api.getDigs({page:e},function(n){cratedigger.loadRecords(n,!1),Routing.changePage(e,t)},function(e){console.log("Error",e)})}return{init:e,loadPage:i,prevPage:n,nextPage:r}}(),Player=function(){function e(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),window.onYouTubeIframeAPIReady=t}function t(){o=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:1,rel:0,showinfo:0,modestbranding:1},events:{onReady:r,onStateChange:i}})}function n(e){a&&(console.log(e.played),o.loadVideoById(e.links.youtube),o.playVideo(),e.played=!0)}function r(){a=!0}function i(){}var o,a=!1;return{init:e,playTrack:n}}(),Routing=function(){function e(){i=$("#cratedigger"),o=parseInt(i.attr("data-cratedigger-page")),window.history.replaceState({page:o},"Page "+o,0===o?"/":"/page/"+o),window.onpopstate=r}function t(){return o}function n(e,t){if(t){var n=0===e?"/":"/page/"+e;window.history.pushState({page:e},"Page "+e,n)}o=e,i.attr("data-cratedigger-page",e)}function r(e){e.state&&e.state.page>=0&&(o=e.state.page,App.loadPage(o))}var i,o=0;return{init:e,changePage:n,getCurrentPage:t}}(),Ui=function(){function e(){o=$("#bottom-bar"),a=o.find(".bottom-bar-prev-button"),c=o.find(".bottom-bar-mid-button"),g=o.find(".bottom-bar-next-button"),d=$(".button-prev-page"),u=$(".button-next-page"),s=$("#cratedigger-record-listen"),l=$(".track .track-artist"),p=$(".track .track-title"),a.on("click",cratedigger.selectPrevRecord),c.on("click",cratedigger.flipSelectedRecord),g.on("click",cratedigger.selectNextRecord),s.on("click",function(){return n(),!1}),d.on("click",function(){return App.prevPage(),!1}),u.on("click",function(){return App.nextPage(),!1})}function t(e,t){console.log(e),f!==e.id&&(f=e.id,l.text(e.artists.join(",")),p.text(e.title),t&&Player.playTrack(e))}function n(){t(cratedigger.getSelectedRecord().data,!0)}function r(){o.addClass("closed")}function i(){o.removeClass("closed")}var o,a,c,g,d,u,s,l,p,f;return{init:e,onInfoPanelOpened:r,onInfoPanelClosed:i}}();
//# sourceMappingURL=app.min.js.map