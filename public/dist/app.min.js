var Api=function(){function e(){$.ajaxSetup({cache:!1})}function t(e,t,r){var a=e.page||0;NProgress.start(),$.getJSON("/digs/page/"+a).done(function(e){t(n(e))}).fail(r).always(function(){NProgress.done()})}function n(e){return $.each(e,function(e,t){t.artist=t.artists.join(", "),t.cover=t.cover.indexOf("http://")>-1?t.cover:"/uploads/"+t.cover,t.hasSleeve=!1,t.links.youtube="//www.youtube.com/watch?v="+t.youtubeId}).reverse()}return{init:e,getDigs:t}}(),App=function(){function e(){Routing.init(),Ui.init(),Player.init(),t(),a(Routing.getCurrentPage())}function t(){cratedigger.init({postprocessing:!1,sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},infoPanelOpened:Ui.onInfoPanelOpened,infoPanelClosed:Ui.onInfoPanelClosed})}function n(){a(Routing.getCurrentPage()-1,!0)}function r(){a(Routing.getCurrentPage()+1,!0)}function a(e,t){Api.getDigs({page:e},function(n){cratedigger.loadRecords(n,!1,function(){Routing.changePage(e,t)})},function(e){console.log("Error",e)})}return{init:e,loadPage:a,prevPage:n,nextPage:r}}(),Comments=function(){function e(e,a){r?n(e,"http://localhost:8080/"+e,a):t(e,"http://localhost:8080/"+e,a)}function t(e,t,n){window.disqus_shortname=a,window.disqus_identifier=e,window.disqus_url=t,window.disqus_title=n;var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="//"+a+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(o),r=!0}function n(e,t,n){DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.identifier=e,this.page.url=t,this.page.title=n}})}var r=!1,a="dihh";return{loadCommentsForTrack:e}}(),Player=function(){function e(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),window.onYouTubeIframeAPIReady=t}function t(){c=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:1,rel:0,showinfo:0,modestbranding:1},events:{onReady:r,onStateChange:a}})}function n(e){d&&(c.loadVideoById(e.youtubeId),c.playVideo(),g=e)}function r(){d=!0}function a(){}function o(){var e=cratedigger.getRecordsDataList(),t=e.indexOf(g);return 0>t?(console.log("Track not found in current crate"),e[0]):t>=e.length-1?e[0]:e[t+1]}function i(){var e=cratedigger.getRecordsDataList(),t=e.indexOf(g);return 0>t?(console.log("Track not found in current crate"),e[e.length-1]):0===t?e[e.length-1]:e[t-1]}var c,d=!1,g=null;return{init:e,playTrack:n,getNextTrack:i,getPrevTrack:o}}(),Routing=function(){function e(){a=$("#cratedigger"),o=parseInt(a.attr("data-cratedigger-page")),window.history.replaceState({page:o},"Page "+o,0===o?"/":"/page/"+o),window.onpopstate=r}function t(){return o}function n(e,t){if(t){var n=0===e?"/":"/page/"+e;window.history.pushState({page:e},"Page "+e,n)}o=e,a.attr("data-cratedigger-page",e)}function r(e){e.state&&e.state.page>=0&&(o=e.state.page,App.loadPage(o))}var a,o=0;return{init:e,changePage:n,getCurrentPage:t}}(),Ui=function(){function e(){c=$("#bottom-bar"),d=c.find(".bottom-bar-prev-button"),g=c.find(".bottom-bar-mid-button"),u=c.find(".bottom-bar-next-button"),s=$(".button-prev-page"),l=$(".button-next-page"),f=$("#cratedigger-record-listen"),p=$(".track .track-artist"),k=$(".track .track-title"),m=$(".track .track-year"),v=$(".track .track-label"),h=$(".track .track-description"),P=$(".track .track-links"),y=$(".button-prev-track"),b=$(".button-next-track"),d.on("click",cratedigger.selectPrevRecord),g.on("click",cratedigger.flipSelectedRecord),u.on("click",cratedigger.selectNextRecord),f.on("click",function(){return n(),!1}),s.on("click",function(){return App.prevPage(),!1}),l.on("click",function(){return App.nextPage(),!1}),y.on("click",o),b.on("click",i)}function t(e,t){if(w!==e._id){var n=e.artists.join(","),r=n+" - "+e.title;w=e._id,p.text(n),k.text(e.title),m.text(e.year),v.text(e.label||""),h.text(e.description||""),P.empty();for(var a in e.links)e.links.hasOwnProperty(a)&&P.append('<a href="'+e.links[a]+'" class="button button-black button-small" target="_blank">'+a+"</a>");Comments.loadCommentsForTrack(e._id,r),t&&Player.playTrack(e)}}function n(){t(cratedigger.getSelectedRecord().data,!0)}function r(){c.addClass("closed")}function a(){c.removeClass("closed")}function o(){t(Player.getPrevTrack(),!0)}function i(){t(Player.getNextTrack(),!0)}var c,d,g,u,s,l,f,p,k,m,v,h,P,y,b,w;return{init:e,onInfoPanelOpened:r,onInfoPanelClosed:a}}();
//# sourceMappingURL=app.min.js.map