var Api=function(){function e(){$.ajaxSetup({cache:!1})}function t(e,t,r){var o=e.page||0;NProgress.start(),$.getJSON("/digs/page/"+o).done(function(e){t(n(e))}).fail(r).always(function(){NProgress.done()})}function n(e){return $.map(e,function(e){return{id:e._id,title:e.title,artist:e.artists.join(", "),artists:e.artists,year:e.year,cover:e.cover.indexOf("http://")>-1?e.cover:"/uploads/"+e.cover,links:e.links,hasSleeve:!1}}).reverse()}return{init:e,getDigs:t}}(),App=function(){function e(){Routing.init(),Ui.init(),Player.init(),t(),o(Routing.getCurrentPage())}function t(){cratedigger.init({sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},infoPanelOpened:Ui.onInfoPanelOpened,infoPanelClosed:Ui.onInfoPanelClosed})}function n(){o(Routing.getCurrentPage()-1,!0)}function r(){o(Routing.getCurrentPage()+1,!0)}function o(e,t){Api.getDigs({page:e},function(n){cratedigger.loadRecords(n,!1),Routing.changePage(e,t)},function(e){console.log("Error",e)})}return{init:e,loadPage:o,prevPage:n,nextPage:r}}(),Player=function(){function e(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),window.onYouTubeIframeAPIReady=t}function t(){console.log("ready"),i=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:1,rel:0,showinfo:0,modestbranding:1},events:{onReady:r,onStateChange:o}})}function n(e){console.log(e),i.loadVideoById(e.links.youtube),i.playVideo()}function r(){}function o(e){console.log("onPlayerStateChange",e)}var i;return{init:e,playTrack:n}}(),Routing=function(){function e(){o=$("#cratedigger"),i=parseInt(o.attr("data-cratedigger-page")),window.onpopstate=r}function t(){return i}function n(e,t){if(t){var n=0===e?"/":"/page/"+e;window.history.pushState({page:e},"Page "+e,n)}i=e,o.attr("data-cratedigger-page",e)}function r(e){e.state&&e.state.page>=0&&(i=e.state.page,App.loadPage(i))}var o,i=0;return{init:e,changePage:n,getCurrentPage:t}}(),Ui=function(){function e(){i=$("#bottom-bar"),a=i.find(".bottom-bar-prev-button"),c=i.find(".bottom-bar-mid-button"),g=i.find(".bottom-bar-next-button"),d=$(".button-prev-page"),u=$(".button-next-page"),l=$("#cratedigger-record-listen"),s=$(".track .track-artist"),f=$(".track .track-title"),a.on("click",cratedigger.selectPrevRecord),c.on("click",cratedigger.flipSelectedRecord),g.on("click",cratedigger.selectNextRecord),l.on("click",function(){return n(),!1}),d.on("click",function(){return App.prevPage(),!1}),u.on("click",function(){return App.nextPage(),!1})}function t(e,t){console.log(e),p!==e.id&&(p=e.id,s.text(e.artists.join(",")),f.text(e.title),t&&Player.playTrack(e))}function n(){t(cratedigger.getSelectedRecord().data,!0)}function r(){i.addClass("closed")}function o(){i.removeClass("closed")}var i,a,c,g,d,u,l,s,f,p;return{init:e,onInfoPanelOpened:r,onInfoPanelClosed:o}}();
//# sourceMappingURL=app.min.js.map