var Api=function(){function e(){$.ajaxSetup({cache:!1})}function t(e,t,r){var o=e.page||0;NProgress.start(),$.getJSON("/digs/page/"+o).done(function(e){t(n(e))}).fail(r).always(function(){NProgress.done()})}function n(e){return $.map(e,function(e){return{title:e.title,artist:e.artists.join(", "),year:e.year,cover:e.cover.indexOf("http://")>-1?e.cover:"/uploads/"+e.cover,hasSleeve:!1}}).reverse()}return{init:e,getDigs:t}}(),App=function(){function e(){Routing.init(),Ui.init(),t(),o(Routing.getCurrentPage())}function t(){cratedigger.init({sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},infoPanelOpened:Ui.onInfoPanelOpened,infoPanelClosed:Ui.onInfoPanelClosed})}function n(){o(Routing.getCurrentPage()-1,!0)}function r(){o(Routing.getCurrentPage()+1,!0)}function o(e,t){Api.getDigs({page:e},function(n){cratedigger.loadRecords(n,!1),Routing.changePage(e,t)},function(e){console.log("Error",e)})}return{init:e,loadPage:o,prevPage:n,nextPage:r}}(),Routing=function(){function e(){o=$("#cratedigger"),i=parseInt(o.attr("data-cratedigger-page")),window.onpopstate=r}function t(){return i}function n(e,t){if(t){var n=0===e?"/":"/page/"+e;window.history.pushState({page:e},"Page "+e,n)}i=e,o.attr("data-cratedigger-page",e)}function r(e){e.state&&e.state.page>=0&&(i=e.state.page,App.loadPage(i))}var o,i=0;return{init:e,changePage:n,getCurrentPage:t}}(),Ui=function(){function e(){r=$("#bottom-bar"),o=r.find(".bottom-bar-prev-button"),i=r.find(".bottom-bar-mid-button"),a=r.find(".bottom-bar-next-button"),g=$(".button-prev-page"),c=$(".button-next-page"),o.on("click",cratedigger.selectPrevRecord),i.on("click",cratedigger.flipSelectedRecord),a.on("click",cratedigger.selectNextRecord),g.on("click",function(){return App.prevPage(),!1}),c.on("click",function(){return App.nextPage(),!1})}function t(){r.addClass("closed")}function n(){r.removeClass("closed")}var r,o,i,a,g,c;return{init:e,onInfoPanelOpened:t,onInfoPanelClosed:n}}();
//# sourceMappingURL=app.min.js.map