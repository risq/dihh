var Api=function(){function e(){$.ajaxSetup({cache:!1})}function t(e,t,i){var r=e.page||0;NProgress.start(),$.getJSON("/digs/page/"+r).done(function(e){t(n(e))}).fail(i).always(function(){NProgress.done()})}function n(e){return $.each(e,function(e,t){t.artist=t.artists.join(", "),t.cover=t.cover.indexOf("http://")>-1?t.cover:"/uploads/"+t.cover,t.hasSleeve=!1,t.links.youtube="//www.youtube.com/watch?v="+t.youtubeId}).reverse()}return{init:e,getDigs:t}}(),App=function(){function e(){Routing.init(),Ui.init(),Player.init(),t(),r(Routing.getCurrentPage())}function t(){cratedigger.init({postprocessing:!1,sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},infoPanelOpened:Ui.onInfoPanelOpened,infoPanelClosed:Ui.onInfoPanelClosed})}function n(){r(Routing.getCurrentPage()-1,!0)}function i(){r(Routing.getCurrentPage()+1,!0)}function r(e,t){Api.getDigs({page:e},function(n){cratedigger.loadRecords(n,!1),Routing.changePage(e,t)},function(e){console.log("Error",e)})}return{init:e,loadPage:r,prevPage:n,nextPage:i}}(),Comments=function(){function e(e,r){i?n(e,"http://localhost:8080/"+e,r):t(e,"http://localhost:8080/"+e,r)}function t(e,t,n){window.disqus_shortname=r,window.disqus_identifier=e,window.disqus_url=t,window.disqus_title=n;var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="//"+r+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(o),i=!0}function n(e,t,n){DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.identifier=e,this.page.url=t,this.page.title=n}})}var i=!1,r="dihh";return{loadCommentsForTrack:e}}(),Player=function(){function e(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),window.onYouTubeIframeAPIReady=t}function t(){o=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:1,rel:0,showinfo:0,modestbranding:1},events:{onReady:i,onStateChange:r}})}function n(e){a&&(console.log(e),o.loadVideoById(e.youtubeId),o.playVideo(),e.played=!0)}function i(){a=!0}function r(){}var o,a=!1;return{init:e,playTrack:n}}(),Routing=function(){function e(){r=$("#cratedigger"),o=parseInt(r.attr("data-cratedigger-page")),window.history.replaceState({page:o},"Page "+o,0===o?"/":"/page/"+o),window.onpopstate=i}function t(){return o}function n(e,t){if(t){var n=0===e?"/":"/page/"+e;window.history.pushState({page:e},"Page "+e,n)}o=e,r.attr("data-cratedigger-page",e)}function i(e){e.state&&e.state.page>=0&&(o=e.state.page,App.loadPage(o))}var r,o=0;return{init:e,changePage:n,getCurrentPage:t}}(),Ui=function(){function e(){o=$("#bottom-bar"),a=o.find(".bottom-bar-prev-button"),c=o.find(".bottom-bar-mid-button"),d=o.find(".bottom-bar-next-button"),g=$(".button-prev-page"),s=$(".button-next-page"),u=$("#cratedigger-record-listen"),l=$(".track .track-artist"),p=$(".track .track-title"),f=$(".track .track-year"),m=$(".track .track-label"),v=$(".track .track-description"),h=$(".track .track-links"),a.on("click",cratedigger.selectPrevRecord),c.on("click",cratedigger.flipSelectedRecord),d.on("click",cratedigger.selectNextRecord),u.on("click",function(){return n(),!1}),g.on("click",function(){return App.prevPage(),!1}),s.on("click",function(){return App.nextPage(),!1})}function t(e,t){if(P!==e._id){var n=e.artists.join(","),i=n+" - "+e.title;P=e._id,l.text(n),p.text(e.title),f.text(e.year),m.text(e.label||""),v.text(e.description||""),h.empty();for(var r in e.links)e.links.hasOwnProperty(r)&&h.append('<a href="'+e.links[r]+'" class="button button-black button-small" target="_blank">'+r+"</a>");Comments.loadCommentsForTrack(e._id,i),t&&Player.playTrack(e)}}function n(){t(cratedigger.getSelectedRecord().data,!0)}function i(){o.addClass("closed")}function r(){o.removeClass("closed")}var o,a,c,d,g,s,u,l,p,f,m,v,h,P;return{init:e,onInfoPanelOpened:i,onInfoPanelClosed:r}}();
//# sourceMappingURL=app.min.js.map