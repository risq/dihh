var Api=function(){function t(){$.ajaxSetup({cache:!1})}function e(t,e,r){var i=t.page||0;NProgress.start(),$.getJSON("/digs/page/"+i).done(function(t){e(n(t))}).fail(r).always(function(){NProgress.done()})}function n(t){return $.each(t,function(t,e){e.artist=e.artists.join(", "),e.cover=e.cover.indexOf("http://")>-1?e.cover:"/uploads/"+e.cover,e.links=e.links||{},e.links.youtube="//www.youtube.com/watch?v="+e.youtubeId}).reverse()}return{init:t,getDigs:e}}(),App=function(){function t(){Intro.init(),Ui.init(),Routing.init(),Player.init(),e(),i(Routing.getCurrentPageId(),Routing.getCurrentDigId(),!1,Intro.startIntro)}function e(){cratedigger.init({debug:!1,postprocessing:!1,sleeveMaskTexture:"/img/sleeve.png",crateTexture:"/img/wood.jpg",elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infoContainerId:"cratedigger-info",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"},onInfoPanelOpened:Ui.onInfoPanelOpened,onInfoPanelClosed:Ui.onInfoPanelClosed})}function n(){i(Routing.getCurrentPageId()-1,null,!0)}function r(){i(Routing.getCurrentPageId()+1,null,!0)}function i(t,e,n,r){Api.getDigs({page:t},function(i){r&&r(),cratedigger.loadRecords(i,!1,function(){Routing.changePage(t,e,n)})},function(t){console.log("Error",t)})}function o(t){for(var e,n=cratedigger.getRecordsDataList(),r=n.slice();e=r.pop();)if(e._id===t)return{dig:e,index:r.length};return null}function a(t){setTimeout(function(){cratedigger.selectRecord(t)},1500)}return{init:t,loadPage:i,prevPage:n,nextPage:r,getRecordById:o,selectRecord:a}}(),Comments=function(){function t(t,i){r?n(t,"http://localhost:8080/"+t,i):e(t,"http://localhost:8080/"+t,i)}function e(t,e,n){window.disqus_shortname=i,window.disqus_identifier=t,window.disqus_url=e,window.disqus_title=n;var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="//"+i+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(o),r=!0}function n(t,e,n){DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.identifier=t,this.page.url=e,this.page.title=n}})}var r=!1,i="dihh";return{loadCommentsForTrack:t}}(),Intro=function(){function t(){i=$(".intro")}function e(){a=!1,setTimeout(n,1e3),setTimeout(function(){r()},15e3)}function n(){o=new Vivus("intro-svg",{file:"/img/intro.svg",type:"delayed",duration:250,start:"autostart"},r)}function r(){a||(a=!0,setTimeout(function(){i.addClass("intro-hidden"),setTimeout(function(){i.remove()},1250)},2e3))}var i,o,a;return{init:t,startIntro:e}}(),Player=function(){function t(){var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),window.onYouTubeIframeAPIReady=e}function e(){c=new YT.Player("player",{height:"100%",width:"100%",playerVars:{autohide:1,rel:0,showinfo:0,modestbranding:1},events:{onReady:r,onStateChange:i}})}function n(t,e){g&&(c.cueVideoById(t.youtubeId),e&&c.playVideo(),u=t)}function r(t){g=!0}function i(t){}function o(){var t=cratedigger.getRecordsDataList(),e=t.indexOf(u);return 0>e?t[0]:e>=t.length-1?t[0]:t[e+1]}function a(){var t=cratedigger.getRecordsDataList(),e=t.indexOf(u);return 0>e?t[t.length-1]:0===e?t[t.length-1]:t[e-1]}var c,g=!1,u=null;return{init:t,loadTrack:n,getNextTrack:a,getPrevTrack:o}}(),Routing=function(){function t(){g=Ui.getCurrentPageId(),u=Ui.getCurrentDigId(),window.onpopstate=r}function e(t,e,n){var r=e?App.getRecordById(e):null,o=r?r.dig.slug:null;if(n){var a=i(t,o);window.history.pushState({page:t},"Page "+t,a)}r&&(Ui.updateTrackView(r.dig),App.selectRecord(r.index)),currentRecord=r?r.dig:c,Ui.updateTitle(currentRecord,t),g=t,Ui.onPageChange(t)}function n(t){var e=i(g,t.slug);c=t,window.history.replaceState({page:g},"Page "+g,e),Ui.updateTitle(t,g)}function r(t){t.state&&t.state.page>=1&&(g=t.state.page,App.loadPage(g))}function i(t,e){return(1===t?"/":"/page/"+t+"/")+(e?"digs/"+e:"")}function o(){return g}function a(){return u}var c,g=0,u=null;return{init:t,changePage:e,changeDig:n,getCurrentPageId:o,getCurrentDigId:a}}(),Ui=function(){function t(){l=$("#cratedigger"),f=$(".page-number"),p=$("#bottom-bar"),m=p.find(".bottom-bar-prev-button"),v=p.find(".bottom-bar-mid-button"),h=p.find(".bottom-bar-next-button"),k=$(".button-prev-page"),I=$(".button-next-page"),P=$("#cratedigger-record-listen"),y=$(".track .track-artist"),w=$(".track .track-title"),b=$(".track .track-year"),C=$(".track .track-label"),T=$(".track .track-description"),R=$(".track .track-links"),x=$(".button-prev-track"),D=$(".button-next-track"),m.on("click",cratedigger.selectPrevRecord),v.on("click",function(){cratedigger.getSelectedRecord()?cratedigger.flipSelectedRecord():cratedigger.selectNextRecord()}),h.on("click",cratedigger.selectNextRecord),P.on("click",function(){return n(),!1}),k.on("click",function(){return App.prevPage(),!1}),I.on("click",function(){return App.nextPage(),!1}),x.on("click",o),D.on("click",a),U=d()}function e(t,e){if(S!==t._id){var n=t.artists.join(","),r=n+" - "+t.title;S=t._id,y.text(n),w.text(t.title),b.text(t.year),C.text(t.label||""),T.text(t.description||""),R.empty();for(var i in t.links)t.links.hasOwnProperty(i)&&R.append('<a href="'+t.links[i]+'" class="button button-black button-small" target="_blank">'+i+"</a>");Comments.loadCommentsForTrack(t._id,r),Routing.changeDig(t),Player.loadTrack(t,e)}}function n(t){var n=cratedigger.getSelectedRecord().data;e(n,!0)}function r(){p.addClass("closed")}function i(){p.removeClass("closed")}function o(){e(Player.getPrevTrack(),!0)}function a(){e(Player.getNextTrack(),!0)}function c(t){l.attr("data-cratedigger-page",t),f.text(t),1===t?k.hide():t===U?I.hide():(k.show(),I.show())}function g(t,e){var n="Digging Into Hip Hop";t&&(n=t.artist+" - "+t.title+" | "+n),e&&e>1&&(n=n+" -\xa8Page "+e),document.title=n}function u(){return parseInt(l.attr("data-cratedigger-page"))}function d(){return parseInt(l.attr("data-cratedigger-pages-count"))}function s(){return l.attr("data-cratedigger-record")||null}var l,f,p,m,v,h,k,I,P,y,w,b,C,T,R,x,D,S,U;return{init:t,updateTrackView:e,onInfoPanelOpened:r,onInfoPanelClosed:i,onPageChange:c,updateTitle:g,getCurrentPageId:u,getPagesCount:d,getCurrentDigId:s}}();
//# sourceMappingURL=app.min.js.map